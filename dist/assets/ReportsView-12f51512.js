import{_ as V,r,o,c as a,b as t,d as h,v as S,t as n,l as k,F as m,i as v,e as T,m as I}from"./index-0c1afda6.js";import{a as N,u as O}from"./sale.store-8ef729cf.js";import{u as E}from"./productos.store-faf1803a.js";import{h as G}from"./html2pdf-58b8d0da.js";const j={class:"container py-4"},L={class:"card mb-4"},M={class:"card-body"},U={class:"row g-3"},$={class:"col-md-4"},q={class:"col-md-4"},z={key:0,class:"text-center my-5"},A={key:1,class:"alert alert-danger"},Q={key:2},H={class:"card mb-4"},J={class:"card-header d-flex justify-content-between align-items-center"},K={class:"card-body"},W={id:"invoices-report"},X={class:"table table-striped"},Y={class:"card mb-4"},Z={class:"card-body"},tt={class:"row"},et={class:"col-md-6"},lt={class:"table"},st={class:"col-md-6"},nt={class:"table"},ot={class:"card"},at={class:"card-body"},rt={class:"table"},dt={__name:"ReportsView",setup(ut){const C=N(),f=O(),D=E(),d=r({startDate:new Date(new Date().setDate(1)).toISOString().slice(0,10),endDate:new Date().toISOString().slice(0,10)}),p=r(!1),c=r(null),g=r(!1),u=r(null),y=r(null),_=r(null),B=async()=>{try{p.value=!0,c.value=null;const s=await Promise.all([C.getInvoicesReport(d.value.startDate,d.value.endDate),D.getTopProductsReport(),f.getSalesByBuyerReport()]);u.value=s[0],y.value=s[1],_.value=s[2],g.value=!0}catch(s){c.value="Error al generar reportes: "+s.message,console.error(s)}finally{p.value=!1}},R=s=>{const e=document.getElementById(s),l={margin:10,filename:`reporte_${new Date().toISOString().slice(0,10)}.pdf`,html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};G().set(l).from(e).save()},i=s=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB"}).format(s),x=s=>new Date(s).toLocaleDateString("es-BO"),w=s=>{const e=f.getBuyerById(s);return e?e.name:"Cliente no encontrado"},F=s=>({completed:"bg-success",pending:"bg-warning text-dark",canceled:"bg-danger"})[s]||"bg-secondary",P=s=>({completed:"Completado",pending:"Pendiente",canceled:"Cancelado"})[s]||s;return(s,e)=>(o(),a("div",j,[e[18]||(e[18]=t("h2",{class:"mb-4"},"Reportes de Ventas",-1)),t("div",L,[t("div",M,[e[5]||(e[5]=t("h5",{class:"card-title"},"Filtros",-1)),t("div",U,[t("div",$,[e[3]||(e[3]=t("label",{class:"form-label"},"Fecha Inicio",-1)),h(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=l=>d.value.startDate=l),class:"form-control"},null,512),[[S,d.value.startDate]])]),t("div",q,[e[4]||(e[4]=t("label",{class:"form-label"},"Fecha Fin",-1)),h(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=l=>d.value.endDate=l),class:"form-control"},null,512),[[S,d.value.endDate]])]),t("div",{class:"col-md-4 d-flex align-items-end"},[t("button",{onClick:B,class:"btn btn-primary"}," Generar Reportes ")])])])]),p.value?(o(),a("div",z,e[6]||(e[6]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Cargando...")],-1),t("p",null,"Generando reportes...",-1)]))):c.value?(o(),a("div",A,n(c.value),1)):g.value?(o(),a("div",Q,[t("div",H,[t("div",J,[e[8]||(e[8]=t("h5",null,"Reporte de Facturas",-1)),t("button",{onClick:e[2]||(e[2]=l=>R("invoices-report")),class:"btn btn-sm btn-outline-secondary"},e[7]||(e[7]=[t("i",{class:"fas fa-file-pdf"},null,-1),k(" Exportar ")]))]),t("div",K,[t("div",W,[e[10]||(e[10]=t("h6",null,"Resumen",-1)),t("ul",null,[t("li",null,"Total Facturas: "+n(u.value.summary.totalInvoices),1),t("li",null,"Total Ventas: "+n(i(u.value.summary.totalAmount)),1),t("li",null,"Facturas Canceladas: "+n(u.value.summary.totalCanceled),1)]),t("table",X,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"N° Factura"),t("th",null,"Fecha"),t("th",null,"Cliente"),t("th",null,"Total"),t("th",null,"Estado")])],-1)),t("tbody",null,[(o(!0),a(m,null,v(u.value.invoices,l=>(o(),a("tr",{key:l.id},[t("td",null,n(l.invoiceNumber),1),t("td",null,n(x(l.date)),1),t("td",null,n(w(l.buyer_id)),1),t("td",null,n(i(l.total)),1),t("td",null,[t("span",{class:I(["badge",F(l.status)])},n(P(l.status)),3)])]))),128))])])])])]),t("div",Y,[e[15]||(e[15]=t("div",{class:"card-header"},[t("h5",null,"Productos Más Vendidos")],-1)),t("div",Z,[t("div",tt,[t("div",et,[e[12]||(e[12]=t("h6",null,"Por Cantidad",-1)),t("table",lt,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"Producto"),t("th",null,"Cantidad"),t("th",null,"Total")])],-1)),t("tbody",null,[(o(!0),a(m,null,v(y.value.topByQuantity,(l,b)=>(o(),a("tr",{key:"qty-"+b},[t("td",null,n(l.name),1),t("td",null,n(l.totalSold),1),t("td",null,n(i(l.totalRevenue)),1)]))),128))])])]),t("div",st,[e[14]||(e[14]=t("h6",null,"Por Valor",-1)),t("table",nt,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",null,"Producto"),t("th",null,"Total"),t("th",null,"Cantidad")])],-1)),t("tbody",null,[(o(!0),a(m,null,v(y.value.topByRevenue,(l,b)=>(o(),a("tr",{key:"rev-"+b},[t("td",null,n(l.name),1),t("td",null,n(i(l.totalRevenue)),1),t("td",null,n(l.totalSold),1)]))),128))])])])])])]),t("div",ot,[e[17]||(e[17]=t("div",{class:"card-header"},[t("h5",null,"Ventas por Cliente")],-1)),t("div",at,[t("table",rt,[e[16]||(e[16]=t("thead",null,[t("tr",null,[t("th",null,"Cliente"),t("th",null,"Facturas"),t("th",null,"Productos"),t("th",null,"Total Comprado")])],-1)),t("tbody",null,[(o(!0),a(m,null,v(_.value.buyers,l=>(o(),a("tr",{key:l.id},[t("td",null,n(l.name),1),t("td",null,n(l.invoiceCount),1),t("td",null,n(l.totalPurchases),1),t("td",null,n(i(l.totalSpent)),1)]))),128))])])])])])):T("",!0)]))}},pt=V(dt,[["__scopeId","data-v-02a5f539"]]);export{pt as default};
