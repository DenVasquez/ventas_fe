import{_ as T,r as v,f as U,g as w,h as S,o as a,c as n,b as e,l as C,e as c,d,v as m,k,t as r,F as q,i as I,w as L,j as O,p as $,m as B}from"./index-0c1afda6.js";import{u as j}from"./sale.store-8ef729cf.js";const F={class:"container py-4"},A={class:"d-flex justify-content-between align-items-center mb-3"},G={class:"mb-3"},J={key:0,class:"text-center my-4"},z={key:1,class:"alert alert-danger"},H={key:2,class:"table-responsive"},K={class:"table table-bordered table-hover mb-0"},P={class:"d-flex align-items-center"},Q=["onClick"],R=["onClick"],W=["onClick"],X={class:"row g-2 mb-2"},Y={class:"col-md-6"},Z=["readonly"],ee={class:"col-md-6"},te=["readonly"],le={class:"row g-2 mb-2"},oe={class:"col-md-6"},se=["readonly"],ae={class:"col-md-6"},ne=["readonly"],re={class:"row g-2 mb-2"},ie={class:"col-md-6"},de=["disabled"],ue={class:"col-md-6"},me=["readonly"],ce={class:"mb-2"},pe=["readonly"],ve={key:0,class:"mb-2"},ye={class:"d-flex justify-content-end mt-3"},be={key:0,type:"submit",class:"btn btn-outline-primary"},fe={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},_e={__name:"BuyersView",setup(ge){const u=j(),b=v(""),f=v(!0),y=v(!1),o=U({id:null,name:"",company:"",phone:"",email:"",type:"mayorista",tax_id:"",address:"",is_active:!0}),_=v(null),p=v("new"),E=w(()=>{const s=b.value.toLowerCase();return u.buyers.filter(t=>t.name.toLowerCase().includes(s)||t.company.toLowerCase().includes(s)||t.phone.toLowerCase().includes(s)||t.email.toLowerCase().includes(s))}),i=w(()=>p.value==="view"),M=w(()=>p.value==="new"?"Nuevo Comprador":p.value==="edit"?"Editar Comprador":"Detalles del Comprador");function g(s,t=null){p.value=s,t?Object.assign(o,JSON.parse(JSON.stringify(t))):h(),_.value.showModal()}function x(){_.value.close(),h()}function h(){o.id=null,o.name="",o.company="",o.phone="",o.email="",o.type="mayorista",o.tax_id="",o.address="",o.is_active=!0}async function N(){y.value=!0;try{p.value==="new"?await u.addBuyer({...o}):await u.updateBuyer(o.id,{...o}),x()}catch(s){console.error("Error al guardar comprador:",s),alert("Ocurrió un error al guardar el comprador")}finally{y.value=!1}}async function D(s){if(confirm("¿Está seguro de eliminar este comprador?"))try{await u.deleteBuyer(s)}catch(t){console.error("Error al eliminar comprador:",t),alert("Ocurrió un error al eliminar el comprador")}}return S(async()=>{try{await u.fetchBuyers()}catch(s){console.error("Error al cargar compradores:",s)}}),(s,t)=>(a(),n("div",F,[e("div",A,[t[12]||(t[12]=e("h2",null,"Lista de Compradores",-1)),f.value?(a(),n("button",{key:0,class:"btn btn-success",onClick:t[0]||(t[0]=l=>g("new"))},t[11]||(t[11]=[e("i",{class:"fa-solid fa-plus me-1"},null,-1),C(" Nuevo Comprador ")]))):c("",!0)]),e("div",G,[d(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>b.value=l),type:"text",class:"form-control",placeholder:"Filtrar por nombre, empresa o contacto..."},null,512),[[m,b.value]])]),k(u).loading?(a(),n("div",J,t[13]||(t[13]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Cargando...")],-1),e("p",{class:"mt-2"},"Cargando compradores...",-1)]))):k(u).error?(a(),n("div",z," Error al cargar compradores: "+r(k(u).error),1)):(a(),n("div",H,[e("table",K,[t[17]||(t[17]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Acciones"),e("th",null,"ID"),e("th",null,"Nombre"),e("th",null,"Empresa"),e("th",null,"Contacto"),e("th",null,"Email"),e("th",null,"CI o NIT"),e("th",null,"Tipo"),e("th",null,"Estado"),e("th",null,"Dirección")])],-1)),e("tbody",null,[(a(!0),n(q,null,I(E.value,l=>(a(),n("tr",{key:l.id},[e("td",null,[e("div",P,[e("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:V=>g("view",l)},t[14]||(t[14]=[e("i",{class:"fa-solid fa-eye"},null,-1)]),8,Q),f.value?(a(),n("button",{key:0,class:"btn btn-sm btn-outline-success me-1",onClick:V=>g("edit",l)},t[15]||(t[15]=[e("i",{class:"fa-solid fa-pen-to-square"},null,-1)]),8,R)):c("",!0),f.value?(a(),n("button",{key:1,class:"btn btn-sm btn-outline-secondary",onClick:V=>D(l.id)},t[16]||(t[16]=[e("i",{class:"fa-solid fa-trash"},null,-1)]),8,W)):c("",!0)])]),e("td",null,r(l.id),1),e("td",null,r(l.name),1),e("td",null,r(l.company),1),e("td",null,r(l.phone),1),e("td",null,r(l.email),1),e("td",null,r(l.tax_id),1),e("td",null,[e("span",{class:B(["badge",l.type==="mayorista"?"bg-primary":"bg-success"])},r(l.type==="mayorista"?"Mayorista":"Minorista"),3)]),e("td",null,[e("span",{class:B(["badge",l.is_active?"bg-success":"bg-secondary"])},r(l.is_active?"Activo":"Inactivo"),3)]),e("td",null,r(l.address),1)]))),128))])])])),e("dialog",{ref_key:"buyerDialog",ref:_,class:"p-0 border-0"},[e("form",{onSubmit:L(N,["prevent"]),class:"p-3"},[e("h5",null,r(M.value),1),e("div",X,[e("div",Y,[t[18]||(t[18]=e("label",null,"Nombre completo",-1)),d(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>o.name=l),type:"text",class:"form-control",readonly:i.value,required:""},null,8,Z),[[m,o.name]])]),e("div",ee,[t[19]||(t[19]=e("label",null,"Empresa",-1)),d(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>o.company=l),type:"text",class:"form-control",readonly:i.value},null,8,te),[[m,o.company]])])]),e("div",le,[e("div",oe,[t[20]||(t[20]=e("label",null,"Teléfono",-1)),d(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>o.phone=l),type:"tel",class:"form-control",readonly:i.value,required:""},null,8,se),[[m,o.phone]])]),e("div",ae,[t[21]||(t[21]=e("label",null,"Email",-1)),d(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>o.email=l),type:"email",class:"form-control",readonly:i.value,required:""},null,8,ne),[[m,o.email]])])]),e("div",re,[e("div",ie,[t[23]||(t[23]=e("label",null,"Tipo de comprador",-1)),d(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>o.type=l),class:"form-select",disabled:i.value,required:""},t[22]||(t[22]=[e("option",{value:"mayorista"},"Mayorista",-1),e("option",{value:"minorista"},"Minorista",-1)]),8,de),[[O,o.type]])]),e("div",ue,[t[24]||(t[24]=e("label",null,"CI o NIT",-1)),d(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>o.tax_id=l),type:"text",class:"form-control",readonly:i.value,required:""},null,8,me),[[m,o.tax_id]])])]),e("div",ce,[t[25]||(t[25]=e("label",null,"Dirección",-1)),d(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=l=>o.address=l),class:"form-control",readonly:i.value,rows:"2",required:""},null,8,pe),[[m,o.address]])]),i.value?c("",!0):(a(),n("div",ve,[e("label",null,[d(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>o.is_active=l),type:"checkbox",class:"form-check-input me-2"},null,512),[[$,o.is_active]]),t[26]||(t[26]=C(" Comprador activo "))])])),e("div",ye,[e("button",{type:"button",class:"btn btn-secondary me-2",onClick:t[10]||(t[10]=l=>x())},"Cancelar"),i.value?c("",!0):(a(),n("button",be,[y.value?(a(),n("span",fe)):c("",!0),C(" "+r(y.value?"Guardando...":"Guardar"),1)]))])],32)],512)]))}},ke=T(_e,[["__scopeId","data-v-b3da4889"]]);export{ke as default};
