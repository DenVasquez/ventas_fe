import{C as n}from"./index-0c1afda6.js";import{b as c,a as i}from"./sale.store-8ef729cf.js";const h=n("producto",{state:()=>({productos:[],loading:!1,error:null}),actions:{async fetchProductos(){this.loading=!0,this.error=null;try{this.productos=await c.getProductos()}catch(o){throw this.error=o.message,o}finally{this.loading=!1}},async addProducto(o){this.loading=!0;try{const t=await c.addProducto(o);return this.productos.push(t),t}catch(t){throw this.error=t.message,t}finally{this.loading=!1}},async updateProducto(o,t){this.loading=!0;try{const r=await c.updateProducto(o,t),s=this.productos.findIndex(e=>e.id===o);return s!==-1&&(this.productos[s]=r),r}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async deleteProducto(o){this.loading=!0;try{await c.deleteProducto(o),this.productos=this.productos.filter(t=>t.id!==o)}catch(t){throw this.error=t.message,t}finally{this.loading=!1}},getProductoById(o){return this.productos.find(t=>t.cod===o)},async getTopProductsReport(o=5){const t=i();await t.fetchSales();const r={};return t.sales.filter(s=>s.status!=="canceled").forEach(s=>{s.items.forEach(e=>{const a=this.productos.find(d=>d.cod===e.product_code)||{cod:e.product_code,name:"Producto no encontrado",stock:0};r[a.cod]||(r[a.cod]={...a,totalSold:0,totalRevenue:0}),r[a.cod].totalSold+=e.quantity,r[a.cod].totalRevenue+=e.quantity*(e.unit_price||a.unit_cost||0)})}),Object.values(r).sort((s,e)=>e.totalSold-s.totalSold).slice(0,o)}},getters:{productosConMateriales:o=>{const t=useMaterialStore();return o.productos.map(r=>({...r,materialesInfo:r.bom.map(s=>{const e=t.materiales.find(a=>a.cod===s.cod);return{...s,name:e?e.name:"Material no encontrado",unit_cost:e?e.unit_cost:0,stock:e?e.stock:0}})}))},productosBajoStock:o=>(t=5)=>o.productos.filter(r=>r.stock<t)}});export{h as u};
